<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bar Break-Even Calculator | Daily Drinks Needed</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <script type="module" src="js/utils/format.js"></script>
  <script type="module" src="js/utils/state.js"></script>
  <script type="module" src="js/utils/ui.js"></script>
  <script type="module" src="js/calculator-core.js"></script>
  <script type="module" src="js/neighborhoods.js"></script>
  <script type="module" src="js/calculator.js"></script>
</head>
<body>
  <header class="toolbar">
    <div class="toolbar-row">
      <h1>Bar Break-Even Calculator</h1>
      <div class="neighborhood-select">
        <label for="neighborhoodSelect" class="neighborhood-label">üìç Compare with Brooklyn Averages</label>
        <select id="neighborhoodSelect" aria-label="Select a Brooklyn neighborhood to see average bar costs">
          <option value="" disabled selected>Select a neighborhood...</option>
        </select>
      </div>
    </div>
  </header>

  <div class="container">
    <section class="neighborhood-card" role="complementary">
      <h2>Brooklyn Averages</h2>
      <p>Compare your numbers to local bar averages</p>
      <div id="averagesDisplay" aria-live="polite"></div>
    </section>

    <main class="card" role="main">
      <h1>Bar Break-Even Calculator</h1>
      <p class="lead">Calculate your daily drink sales target to cover fixed costs and stay profitable.</p>

      <form id="calcForm" novalidate>
        <div class="grid">
          <div>
            <label for="rent"><span class="field-icon">üè¢</span> Monthly Rent ($)</label>
            <input id="rent" name="rent" type="number" min="0" step="0.01" placeholder="e.g. 4000" required
                   inputmode="decimal" pattern="[0-9]*[.,]?[0-9]+" autocomplete="off">
          </div>

          <div>
            <label for="labor"><span class="field-icon">üë•</span> Monthly Labor Costs ($)</label>
            <input id="labor" name="labor" type="number" min="0" step="0.01" placeholder="e.g. 8000" required
                   inputmode="decimal" pattern="[0-9]*[.,]?[0-9]+" autocomplete="off">
          </div>

          <div>
            <label for="other"><span class="field-icon">‚ö°</span> Other Monthly Expenses ($)</label>
            <input id="other" name="other" type="number" min="0" step="0.01" placeholder="e.g. 2000" required
                   inputmode="decimal" pattern="[0-9]*[.,]?[0-9]+" autocomplete="off" value="0">
          </div>

          <div>
            <label for="cost"><span class="field-icon">ü•É</span> Cost to Make One Drink ($)</label>
            <input id="cost" name="cost" type="number" min="0" step="0.01" placeholder="e.g. 1.20" required
                   inputmode="decimal" pattern="[0-9]*[.,]?[0-9]+" autocomplete="off">
          </div>

          <div>
            <label for="price"><span class="field-icon">üíµ</span> Selling Price Per Drink ($)</label>
            <input id="price" name="price" type="number" min="0" step="0.01" placeholder="e.g. 6.50" required
                   inputmode="decimal" pattern="[0-9]*[.,]?[0-9]+" autocomplete="off">
          </div>

          <div>
            <label for="days"><span class="field-icon">üìÖ</span> Days Open Per Month</label>
            <input id="days" name="days" type="number" min="1" step="1" value="30" required
                   inputmode="decimal" pattern="[0-9]*" autocomplete="off">
          </div>
        </div>

        <div class="actions">
          <button id="calculate" type="submit">Calculate Break-Even</button>
          <button id="reset" type="reset" class="secondary">Reset Form</button>
          <div class="muted">All fields required. Enter amounts in $.</div>
        </div>

        <div id="error" class="error" role="alert" aria-live="polite" style="display:none"></div>
      </form>
    </main>

    <div id="resultCard" class="card result-card" role="status" aria-live="polite" style="display:none">
      <div id="result" class="result">
        <h2><span class="status"></span> <span id="headline"></span></h2>
        <div id="details" class="muted"></div>
        <div class="metrics">
          <div class="metric">
            <div class="metric-label">Profit per Drink</div>
            <div class="metric-value" id="profitPerDrink"></div>
          </div>
          <div class="metric">
            <div class="metric-label">Monthly Drinks Needed</div>
            <div class="metric-value" id="monthlyDrinks"></div>
          </div>
          <div class="metric">
            <div class="metric-label">Monthly Costs</div>
            <div class="metric-value" id="monthlyCosts"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const form = document.getElementById('calcForm');
      const rentEl = document.getElementById('rent');
      const laborEl = document.getElementById('labor');
      const otherEl = document.getElementById('other');
      const costEl = document.getElementById('cost');
      const priceEl = document.getElementById('price');
      const daysEl = document.getElementById('days');
      const errEl = document.getElementById('error');
      const resultCard = document.getElementById('resultCard');
      const resultEl = document.getElementById('result');
      const headline = document.getElementById('headline');
      const details = document.getElementById('details');
      const profitPerDrinkEl = document.getElementById('profitPerDrink');
      const monthlyDrinksEl = document.getElementById('monthlyDrinks');
      const monthlyCostsEl = document.getElementById('monthlyCosts');
      const resetBtn = document.getElementById('reset');

      function formatMoney(n){
        return '$' + Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
      }

      function showError(message){
        errEl.textContent = message;
        errEl.style.display = 'block';
        resultCard.style.display = 'none';
      }

      function clearError(){
        errEl.textContent = '';
        errEl.style.display = 'none';
      }

      function getBreakEvenStatus(drinksPerDay) {
        if (drinksPerDay <= 100) return 'sustainable';
        if (drinksPerDay <= 200) return 'tight';
        return 'unsustainable';
      }

      form.addEventListener('submit', function(e){
        e.preventDefault();
        clearError();

        const rent = parseFloat(rentEl.value) || 0;
        const labor = parseFloat(laborEl.value) || 0;
        const other = parseFloat(otherEl.value) || 0;
        const cost = parseFloat(costEl.value) || 0;
        const price = parseFloat(priceEl.value) || 0;
        const days = parseInt(daysEl.value,10) || 30;

        // Basic validation
        if (rent < 0 || labor < 0 || other < 0 || cost < 0 || price < 0 || days < 1) {
          showError('Please enter valid non-negative numbers for all fields (days must be at least 1).');
          return;
        }

        if (price <= cost) {
          showError('Selling price must be higher than the cost to make a drink to generate profit.');
          return;
        }

        const profitPerDrink = price - cost;
        const totalMonthly = rent + labor + other;
        const monthlyDrinks = totalMonthly / profitPerDrink;
        const drinksPerDay = monthlyDrinks / days;
        const drinksPerDayRounded = Math.ceil(drinksPerDay);

        // Update status and display
        const status = getBreakEvenStatus(drinksPerDayRounded);
        resultEl.className = `result ${status}`;
        
        headline.textContent = `You need to sell ${drinksPerDayRounded} drink${drinksPerDayRounded === 1 ? '' : 's'} per day`;
        
        profitPerDrinkEl.textContent = formatMoney(profitPerDrink);
        monthlyDrinksEl.textContent = Math.ceil(monthlyDrinks).toLocaleString();
        monthlyCostsEl.textContent = formatMoney(totalMonthly);

        resultCard.style.display = 'block';
        // Trigger reflow for animation
        resultCard.offsetHeight;
        resultCard.classList.add('visible');
      });

      resetBtn.addEventListener('click', function() {
        clearError();
        resultCard.classList.remove('visible');
        [profitPerDrinkEl, monthlyCostsEl, monthlyDrinksEl].forEach(el => {
          el.classList.remove('reveal');
        });
        setTimeout(() => resultCard.style.display = 'none', 200);
      });

      // Clear error when user corrects selling/cost fields
      [priceEl,costEl].forEach(el => el.addEventListener('input', clearError));

    })();
  </script>
</body>
</html>
